<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>hola.cloud Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --color-brand: #5666f5;
      --color-brand-600: #3a4be6;
      --color-brand-100: #e6e9ff;
      --color-accent: #ff7a59;
      --color-success: #16a34a;
      --color-warning: #f59e0b;
      --color-danger: #dc2626;
      --color-neutral-50: #f8fafc;
      --color-neutral-100: #f1f5f9;
      --color-neutral-200: #e2e8f0;
      --color-neutral-300: #cbd5f5;
      --color-neutral-400: #94a3b8;
      --color-neutral-500: #64748b;
      --color-neutral-600: #475569;
      --color-neutral-700: #334155;
      --color-neutral-800: #1e293b;
      --color-neutral-900: #0f172a;
      --color-text-primary: #0f172a;
      --color-text-secondary: #475569;
      --color-text-muted: #64748b;
      --color-text-inverse: #f8fafc;
      --color-border-subtle: rgba(15, 23, 42, 0.08);
      --color-border-strong: rgba(15, 23, 42, 0.14);
      --color-background: #f8fafc;
      --color-surface: #ffffff;
      --color-surface-elevated: #ffffff;
      --color-surface-muted: #eef2ff;
      --color-sidebar: #ffffff;
      --color-sidebar-elevated: #eef2ff;
      --color-tabbar: #eef2ff;
      --color-tab-text: #475569;
      --color-tab-text-active: #1f2937;
      --color-tab-hover: rgba(86, 102, 245, 0.12);
      --color-tab-active: rgba(86, 102, 245, 0.18);
      --color-log-background: #111c30;
      --color-log-border: rgba(15, 23, 42, 0.12);
      --color-select-background: #ffffff;
      --color-select-text: #0f172a;
      --color-select-placeholder: #64748b;
      --color-select-border: rgba(86, 102, 245, 0.28);
      --select-chevron: #475569;
      --nav-icon-filter: none;
      --background-aurora: radial-gradient(circle at 20% 15%, rgba(86, 102, 245, 0.2), transparent 60%),
        radial-gradient(circle at 75% 0%, rgba(255, 122, 89, 0.18), transparent 45%),
        linear-gradient(180deg, rgba(255, 255, 255, 0.95), var(--color-background));
      --overlay-color: rgba(2, 6, 23, 0.45);
      --sidebar-shadow: 0 18px 38px rgba(15, 23, 42, 0.16);
      --button-ghost-border: rgba(86, 102, 245, 0.24);
      --button-ghost-hover: rgba(86, 102, 245, 0.08);
      --input-background: #ffffff;
      --input-border: rgba(148, 163, 184, 0.35);
      --input-placeholder: #94a3b8;
      --empty-background: rgba(86, 102, 245, 0.08);
      --workspace-gradient: linear-gradient(180deg, rgba(86, 102, 245, 0.08), rgba(248, 250, 252, 0.95));
      --border-radius-sm: 0.5rem;
      --border-radius-md: 0.75rem;
      --border-radius-lg: 1rem;
      --shadow-sm: 0 1px 2px rgba(15, 23, 42, 0.08);
      --shadow-md: 0 10px 20px rgba(15, 23, 42, 0.12);
      --shadow-lg: 0 20px 40px rgba(15, 23, 42, 0.16);
      --sidebar-width: 320px;
      --transition-base: 0.18s ease;
      --log-panel-height: 280px;
    }

    [data-theme='dark'] {
      --color-neutral-50: #0f172a;
      --color-neutral-100: #172554;
      --color-neutral-200: #1d2a5e;
      --color-neutral-300: #24316a;
      --color-neutral-400: #334072;
      --color-neutral-500: #47536f;
      --color-neutral-600: #64748b;
      --color-neutral-700: #94a3b8;
      --color-neutral-800: #cbd5f5;
      --color-neutral-900: #e2e8f0;
      --color-text-primary: #f8fafc;
      --color-text-secondary: #cbd5f5;
      --color-text-muted: #94a3b8;
      --color-border-subtle: rgba(148, 163, 184, 0.24);
      --color-border-strong: rgba(148, 163, 184, 0.36);
      --color-background: #020617;
      --color-surface: #0b1220;
      --color-surface-elevated: #111c30;
      --color-surface-muted: rgba(86, 102, 245, 0.12);
      --color-sidebar: #0b1220;
      --color-sidebar-elevated: #111c30;
      --color-tabbar: rgba(12, 20, 35, 0.92);
      --color-tab-text: #cbd5f5;
      --color-tab-text-active: #f8fafc;
      --color-tab-hover: rgba(86, 102, 245, 0.14);
      --color-tab-active: rgba(86, 102, 245, 0.2);
      --color-log-background: #0b1220;
      --color-log-border: rgba(86, 102, 245, 0.24);
      --color-select-background: rgba(15, 23, 42, 0.85);
      --color-select-text: #f8fafc;
      --color-select-placeholder: #94a3b8;
      --color-select-border: rgba(148, 163, 184, 0.28);
      --select-chevron: #cbd5f5;
      --nav-icon-filter: brightness(1.2);
      --background-aurora: radial-gradient(circle at 20% 20%, rgba(86, 102, 245, 0.18), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(255, 122, 89, 0.12), transparent 45%),
        linear-gradient(180deg, rgba(15, 23, 42, 0.92), var(--color-background));
      --overlay-color: rgba(2, 6, 23, 0.55);
      --sidebar-shadow: 0 24px 48px rgba(2, 6, 23, 0.4);
      --button-ghost-border: rgba(148, 163, 184, 0.25);
      --button-ghost-hover: rgba(86, 102, 245, 0.16);
      --input-background: rgba(15, 23, 42, 0.7);
      --input-border: rgba(148, 163, 184, 0.24);
      --input-placeholder: #94a3b8;
      --empty-background: rgba(86, 102, 245, 0.12);
      --workspace-gradient: linear-gradient(180deg, rgba(13, 23, 43, 0.85), rgba(9, 16, 31, 0.95));
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --color-neutral-50: #0f172a;
        --color-neutral-100: #172554;
        --color-neutral-200: #1d2a5e;
        --color-neutral-300: #24316a;
        --color-neutral-400: #334072;
        --color-neutral-500: #47536f;
        --color-neutral-600: #64748b;
        --color-neutral-700: #94a3b8;
        --color-neutral-800: #cbd5f5;
        --color-neutral-900: #e2e8f0;
        --color-text-primary: #f8fafc;
        --color-text-secondary: #cbd5f5;
        --color-text-muted: #94a3b8;
        --color-border-subtle: rgba(148, 163, 184, 0.24);
        --color-border-strong: rgba(148, 163, 184, 0.36);
        --color-background: #020617;
        --color-surface: #0b1220;
        --color-surface-elevated: #111c30;
        --color-surface-muted: rgba(86, 102, 245, 0.12);
        --color-sidebar: #0b1220;
        --color-sidebar-elevated: #111c30;
        --color-tabbar: rgba(12, 20, 35, 0.92);
        --color-tab-text: #cbd5f5;
        --color-tab-text-active: #f8fafc;
        --color-tab-hover: rgba(86, 102, 245, 0.14);
        --color-tab-active: rgba(86, 102, 245, 0.2);
        --color-log-background: #0b1220;
        --color-log-border: rgba(86, 102, 245, 0.24);
        --color-select-background: rgba(15, 23, 42, 0.85);
        --color-select-text: #f8fafc;
        --color-select-placeholder: #94a3b8;
        --color-select-border: rgba(148, 163, 184, 0.28);
        --select-chevron: #cbd5f5;
        --nav-icon-filter: brightness(1.2);
        --background-aurora: radial-gradient(circle at 20% 20%, rgba(86, 102, 245, 0.18), transparent 55%),
          radial-gradient(circle at 80% 10%, rgba(255, 122, 89, 0.12), transparent 45%),
          linear-gradient(180deg, rgba(15, 23, 42, 0.92), var(--color-background));
        --overlay-color: rgba(2, 6, 23, 0.55);
        --sidebar-shadow: 0 24px 48px rgba(2, 6, 23, 0.4);
        --button-ghost-border: rgba(148, 163, 184, 0.25);
        --button-ghost-hover: rgba(86, 102, 245, 0.16);
        --input-background: rgba(15, 23, 42, 0.7);
        --input-border: rgba(148, 163, 184, 0.24);
        --input-placeholder: #94a3b8;
        --empty-background: rgba(86, 102, 245, 0.12);
        --workspace-gradient: linear-gradient(180deg, rgba(13, 23, 43, 0.85), rgba(9, 16, 31, 0.95));
      }
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      height: 100%;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      background-color: var(--color-background);
      color: var(--color-text-primary);
    }

    body {
      min-height: 100vh;
      background-image: var(--background-aurora);
      background-size: cover;
      background-repeat: no-repeat;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body[data-theme='dark'] {
      color-scheme: dark;
    }

    body[data-theme='light'] {
      color-scheme: light;
    }

    a {
      color: var(--color-brand);
      text-decoration: none;
      transition: color var(--transition-base);
    }

    a:hover {
      color: var(--color-brand-600);
    }

    button,
    input,
    textarea {
      font: inherit;
    }

    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .hc-fullscreen-state {
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      text-align: center;
      padding: 2.5rem;
      color: var(--color-text-secondary);
    }

    .hc-spinner {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius-md);
      background: rgba(86, 102, 245, 0.12);
      color: var(--color-brand);
      box-shadow: inset 0 0 0 1px rgba(86, 102, 245, 0.24);
    }

    .hc-spinner::before {
      content: "";
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 3px solid rgba(86, 102, 245, 0.24);
      border-top-color: var(--color-brand);
      animation: hc-spin 0.9s linear infinite;
    }

    @keyframes hc-spin {
      to {
        transform: rotate(360deg);
      }
    }

    .hc-card {
      background: var(--color-surface-elevated);
      border: 1px solid var(--color-border-subtle);
      box-shadow: var(--shadow-md);
      border-radius: var(--border-radius-lg);
      padding: 2.5rem 2.75rem;
      max-width: 420px;
      width: 100%;
      margin: auto;
      color: var(--color-text-primary);
      backdrop-filter: blur(12px);
    }

    .hc-card h1 {
      margin: 0 0 0.75rem;
      font-size: 1.75rem;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .hc-card p {
      margin: 0 0 1.5rem;
      color: var(--color-text-secondary);
      line-height: 1.6;
    }

    .hc-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.7rem 1.6rem;
      border-radius: var(--border-radius-sm);
      border: none;
      font-weight: 600;
      letter-spacing: 0.01em;
      cursor: pointer;
      transition: transform var(--transition-base), box-shadow var(--transition-base),
        background var(--transition-base), border-color var(--transition-base);
      background: linear-gradient(135deg, var(--color-brand), var(--color-brand-600));
      color: #ffffff;
      box-shadow: var(--shadow-sm);
    }

    .hc-button:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--color-brand-600), var(--color-brand));
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(86, 102, 245, 0.22);
    }

    .hc-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .hc-button--ghost {
      background: transparent;
      color: var(--color-text-secondary);
      box-shadow: none;
      border: 1px solid var(--button-ghost-border);
    }

    .hc-button--ghost:hover:not(:disabled) {
      background: var(--button-ghost-hover);
      color: var(--color-text-primary);
    }

    .hc-console {
      position: relative;
      flex: 1;
      min-height: 0;
      display: flex;
    }

    .hc-sidebar-overlay {
      position: fixed;
      inset: 0;
      background: var(--overlay-color);
      backdrop-filter: blur(4px);
      z-index: 30;
    }

    .hc-sidebar {
      position: fixed;
      inset: 0 auto 0 0;
      width: min(90vw, var(--sidebar-width));
      display: flex;
      flex-direction: column;
      background: var(--color-sidebar);
      border-right: 1px solid var(--color-border-subtle);
      box-shadow: var(--sidebar-shadow);
      transform: translateX(-105%);
      transition: transform var(--transition-base);
      z-index: 40;
      max-height: 100vh;
      overflow-y: auto;
      scrollbar-gutter: stable both-edges;
    }

    .hc-sidebar.is-open {
      transform: translateX(0);
    }

    .hc-sidebar__brand {
      padding: 1.25rem 1.5rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.85rem;
      border-bottom: 1px solid var(--color-border-subtle);
      background: var(--color-sidebar-elevated);
    }

    .hc-sidebar__brand-info {
      display: flex;
      align-items: center;
      gap: 0.85rem;
    }

    .hc-sidebar__brand img {
      height: 38px;
      width: auto;
    }

    .hc-sidebar__brand-title {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .hc-sidebar__brand-title span:first-child {
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .hc-sidebar__brand-title span:last-child {
      font-size: 0.8rem;
      color: var(--color-text-muted);
    }

    .hc-sidebar__body {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem 1.75rem 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.75rem;
    }

    .hc-sidebar__body::-webkit-scrollbar {
      width: 10px;
    }

    .hc-sidebar__body::-webkit-scrollbar-track {
      background: rgba(148, 163, 184, 0.15);
      border-radius: 999px;
    }

    .hc-sidebar__body::-webkit-scrollbar-thumb {
      background: rgba(86, 102, 245, 0.35);
      border-radius: 999px;
    }

    .hc-field {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .hc-field label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-muted);
    }

    .hc-select {
      position: relative;
      width: 100%;
    }

    .hc-select__trigger {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      padding: 0.65rem 0.9rem;
      border-radius: 0.65rem;
      border: 1px solid var(--color-select-border);
      background: var(--color-select-background);
      color: var(--color-select-text);
      cursor: pointer;
      transition: border-color var(--transition-base), box-shadow var(--transition-base),
        background var(--transition-base);
    }

    .hc-select__trigger:focus-visible {
      outline: 2px solid rgba(86, 102, 245, 0.5);
      outline-offset: 2px;
    }

    .hc-select__trigger[aria-disabled='true'] {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .hc-select__value {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      text-align: left;
    }

    .hc-select__label {
      font-weight: 600;
      color: var(--color-select-text);
    }

    .hc-select__placeholder {
      color: var(--color-select-placeholder);
    }

    .hc-select__description {
      font-size: 0.75rem;
      color: var(--color-text-muted);
    }

    .hc-select__chevron {
      flex-shrink: 0;
      width: 1rem;
      height: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--select-chevron);
      transition: transform var(--transition-base);
    }

    .hc-select.is-open .hc-select__chevron {
      transform: rotate(180deg);
    }

    .hc-select__dropdown {
      position: absolute;
      z-index: 10;
      top: calc(100% + 0.35rem);
      left: 0;
      right: 0;
      background: var(--color-surface);
      border: 1px solid var(--color-border-subtle);
      border-radius: 0.75rem;
      box-shadow: var(--shadow-lg);
      max-height: 280px;
      overflow-y: auto;
      padding: 0.35rem 0;
    }

    .hc-select__list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .hc-select__option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.55rem 0.9rem;
      cursor: pointer;
      transition: background var(--transition-base), color var(--transition-base);
      color: var(--color-text-primary);
    }

    .hc-select__option.is-active,
    .hc-select__option:hover {
      background: var(--color-surface-muted);
    }

    .hc-select__option.is-selected {
      font-weight: 600;
      color: var(--color-brand);
    }

    .hc-select__option.is-disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .hc-select__option-meta {
      font-size: 0.75rem;
      color: var(--color-text-muted);
    }

    .hc-select-fade-enter-active,
    .hc-select-fade-leave-active {
      transition: opacity 0.12s ease, transform 0.12s ease;
    }

    .hc-select-fade-enter-from,
    .hc-select-fade-leave-to {
      opacity: 0;
      transform: translateY(-4px);
    }

    .hc-sidebar-section {
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
    }

    .hc-sidebar-section__title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--color-text-muted);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .hc-nav-list,
    .hc-nav-children {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .hc-nav-item {
      border-radius: 0.7rem;
      padding: 0.55rem 0.65rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      cursor: pointer;
      background: transparent;
      border: 1px solid transparent;
      transition: background var(--transition-base), border-color var(--transition-base),
        color var(--transition-base);
      color: var(--color-text-primary);
    }

    .hc-nav-item:hover {
      background: var(--color-tab-hover);
      border-color: rgba(86, 102, 245, 0.18);
    }

    .hc-nav-item__label {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .hc-nav-item__label img {
      width: 18px;
      height: 18px;
      object-fit: contain;
      filter: var(--nav-icon-filter);
    }

    .hc-nav-item__meta {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      font-family: "JetBrains Mono", monospace;
    }

    .hc-nav-children {
      padding-left: 0.9rem;
      border-left: 1px solid var(--color-border-subtle);
      margin-left: 0.5rem;
    }

    .hc-nav-child {
      padding: 0.45rem 0.5rem;
      border-radius: 0.6rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background var(--transition-base), border-color var(--transition-base),
        color var(--transition-base);
      border: 1px solid transparent;
      color: var(--color-text-primary);
    }

    .hc-nav-child:hover {
      background: var(--color-tab-hover);
      border-color: rgba(86, 102, 245, 0.16);
    }

    .hc-workspace {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      background: var(--workspace-gradient);
      backdrop-filter: blur(12px);
      margin-left: 0;
    }

    .hc-sidebar-toggle,
    .hc-sidebar-close {
      border: none;
      background: var(--color-surface);
      color: var(--color-text-primary);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: background var(--transition-base), transform var(--transition-base);
    }

    .hc-sidebar-toggle:hover,
    .hc-sidebar-close:hover {
      background: var(--color-surface-muted);
      transform: translateY(-1px);
    }

    .hc-sidebar-close {
      flex-shrink: 0;
    }

    .hc-topbar {
      padding: 1.2rem 2rem 1.1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--color-border-subtle);
      gap: 1.2rem;
    }

    .hc-topbar__title {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .hc-topbar__title h2 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
    }

    .hc-topbar__title span {
      color: var(--color-text-secondary);
      font-size: 0.9rem;
    }

    .hc-topbar__user {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .hc-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid rgba(86, 102, 245, 0.45);
      object-fit: cover;
    }

    .hc-user-meta {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      align-items: flex-end;
      font-size: 0.9rem;
    }

    .hc-user-meta strong {
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .hc-user-meta a {
      font-size: 0.85rem;
      color: var(--color-brand);
    }

    .hc-workspace__content {
      flex: 1;
      padding: 1.75rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      min-height: 0;
    }

    .hc-empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1rem;
      padding: 3rem 2rem;
      border-radius: var(--border-radius-lg);
      background: var(--empty-background);
      color: var(--color-text-secondary);
    }

    .hc-surface {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-radius: var(--border-radius-lg);
      border: 1px solid var(--color-border-subtle);
      background: var(--color-surface);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
      overflow: hidden;
      min-height: 0;
    }

    .hc-tabs {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.55rem 0.75rem;
      border-bottom: 1px solid var(--color-border-subtle);
      background: var(--color-tabbar);
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .hc-tab {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      border-radius: 0.7rem;
      border: 1px solid transparent;
      padding: 0.45rem 0.85rem;
      background: transparent;
      color: var(--color-tab-text);
      cursor: pointer;
      transition: background var(--transition-base), color var(--transition-base),
        border-color var(--transition-base);
      white-space: nowrap;
    }

    .hc-tab img {
      width: 16px;
      height: 16px;
      object-fit: contain;
      filter: var(--nav-icon-filter);
    }

    .hc-tab.is-active {
      background: var(--color-tab-active);
      color: var(--color-tab-text-active);
      border-color: rgba(86, 102, 245, 0.24);
    }

    .hc-tab:hover {
      background: var(--color-tab-hover);
      color: var(--color-tab-text-active);
    }

    .hc-tab__close {
      font-size: 1rem;
      line-height: 1;
      color: var(--color-text-muted);
      transition: color var(--transition-base);
    }

    .hc-tab__close:hover {
      color: var(--color-text-primary);
    }

    .hc-tab-panels {
      position: relative;
      flex: 1;
      display: grid;
    }

    .hc-panel-frame {
      width: 100%;
      border: none;
      flex: 1;
      display: none;
      background: var(--color-background);
    }

    .hc-panel-frame.is-active {
      display: block;
    }

    .hc-log-panel {
      background: var(--color-log-background);
      border-top: 1px solid var(--color-log-border);
      color: var(--color-text-inverse);
      height: var(--log-panel-height);
      display: flex;
      flex-direction: column;
      transition: height 0.25s ease;
    }

    .hc-log-panel.is-collapsed {
      height: 48px;
    }

    .hc-log-panel__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      font-weight: 600;
    }

    .hc-log-panel__actions {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.85rem;
      color: rgba(248, 250, 252, 0.75);
    }

    .hc-log-toggle {
      border: 1px solid rgba(248, 250, 252, 0.35);
      background: transparent;
      color: inherit;
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: background var(--transition-base), color var(--transition-base);
    }

    .hc-log-toggle:hover {
      background: rgba(248, 250, 252, 0.12);
    }

    .hc-log-panel__frame {
      flex: 1;
      border: none;
      background: transparent;
    }

    .hc-log-panel.is-collapsed .hc-log-panel__frame {
      opacity: 0;
      pointer-events: none;
    }

    .hc-form {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .hc-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid var(--input-border);
      background: var(--input-background);
      color: var(--color-text-primary);
      transition: border-color var(--transition-base), box-shadow var(--transition-base);
    }

    .hc-input::placeholder {
      color: var(--input-placeholder);
    }

    .hc-input:focus {
      outline: none;
      border-color: rgba(86, 102, 245, 0.5);
      box-shadow: 0 0 0 3px rgba(86, 102, 245, 0.18);
    }

    .hc-form__actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .hc-projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1.25rem;
    }

    .hc-project-card {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      padding: 1.2rem;
      border-radius: var(--border-radius-md);
      border: 1px solid var(--color-border-subtle);
      background: var(--color-surface);
      cursor: pointer;
      transition: transform var(--transition-base), box-shadow var(--transition-base),
        border-color var(--transition-base);
    }

    .hc-project-card:hover {
      transform: translateY(-2px);
      border-color: rgba(86, 102, 245, 0.32);
      box-shadow: var(--shadow-md);
    }

    .hc-project-card__title {
      font-weight: 600;
      font-size: 1.05rem;
      color: var(--color-text-primary);
    }

    .hc-project-card__meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: var(--color-text-muted);
      font-family: "JetBrains Mono", monospace;
    }

    .hc-project-card__actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      font-size: 0.85rem;
    }

    .hc-project-card__actions a {
      color: var(--color-brand);
    }

    .hc-sidebar--collapsed .hc-sidebar__body {
      display: none;
    }

    .hc-console:has(.hc-sidebar.is-open) {
      overflow: hidden;
    }

    @media (min-width: 1024px) {
      .hc-sidebar {
        position: sticky;
        inset: 0;
        width: var(--sidebar-width);
        max-width: var(--sidebar-width);
        transform: none;
        box-shadow: none;
      }

      .hc-sidebar-overlay {
        display: none;
      }

      .hc-console {
        display: grid;
        grid-template-columns: var(--sidebar-width) 1fr;
        min-height: 0;
      }

      .hc-workspace {
        background: var(--workspace-gradient);
      }
    }

    @media (max-width: 1023px) {
      :root {
        --sidebar-width: 290px;
        --log-panel-height: 240px;
      }

      .hc-topbar {
        padding: 1rem 1.5rem;
      }

      .hc-workspace__content {
        padding: 1.25rem;
      }
    }

    @media (max-width: 720px) {
      .hc-topbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .hc-user-meta {
        align-items: flex-start;
      }

      .hc-workspace__content {
        padding: 1rem;
      }

      .hc-surface {
        border-radius: var(--border-radius-md);
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div v-if="user === 'loading'" class="hc-fullscreen-state">
      <div class="hc-spinner">Validando sesi√≥n‚Ä¶</div>
      <span style="color: var(--color-neutral-400); font-size: 0.95rem;">Conectando con hola.cloud</span>
    </div>

    <div v-else-if="user === null" class="hc-card">
      <h1>Bienvenido a hola.cloud</h1>
      <p>
        Administra tus bases de datos, funciones y archivos desde una consola unificada inspirada en un IDE profesional.
        Inicia sesi√≥n para sincronizar tus proyectos.
      </p>
      <div style="display: flex; justify-content: center;">
        <a href="https://hola.cloud/auth/login" class="hc-button">Iniciar sesi√≥n</a>
      </div>
    </div>

    <div v-else class="hc-console" :class="{'hc-sidebar--collapsed': !tricks.showtree && !project}">
      <div
        v-if="ui.isMobile && ui.sidebarOpen"
        class="hc-sidebar-overlay"
        @click="toggleSidebar(false)"
      ></div>
      <aside class="hc-sidebar" :class="{'is-open': ui.sidebarOpen || !ui.isMobile}">
        <div class="hc-sidebar__brand">
          <div class="hc-sidebar__brand-info">
            <img src="img/logo-short.png" alt="hola.cloud" />
            <div class="hc-sidebar__brand-title">
              <span>hola.cloud Console</span>
              <span>Tu plataforma operativa</span>
            </div>
          </div>
          <button
            v-if="ui.isMobile"
            type="button"
            class="hc-sidebar-close"
            aria-label="Cerrar navegaci√≥n"
            @click="toggleSidebar(false)"
          >
            √ó
          </button>
        </div>
        <div class="hc-sidebar__body">
          <div class="hc-field" v-if="projects.length">
            <label for="project-select">Proyecto actual</label>
            <HcSelect
              id="project-select"
              v-model="project_id"
              :options="projectOptions"
              placeholder="Selecciona un proyecto"
              :disabled="!projects.length"
              @change="handleProjectChange"
            ></HcSelect>
          </div>

          <div class="hc-sidebar-section" v-if="project">
            <div class="hc-sidebar-section__title">Bases de datos</div>
            <ul class="hc-nav-list">
              <li v-for="database in tree.databases" :key="database.id">
                <div class="hc-nav-item" @click="expandDatabase(database)">
                  <div class="hc-nav-item__label">
                    <img src="img/icon-database.svg" alt="Base de datos" />
                    <span>{{ database.name }}</span>
                  </div>
                  <span class="hc-nav-item__meta">{{ database.open ? '‚àí' : '+' }}</span>
                </div>
                <ul class="hc-nav-children" v-if="database.open">
                  <li
                    class="hc-nav-child"
                    v-for="collection in database.collections"
                    :key="collection.name"
                    @click.stop="openCollection(database, collection)"
                  >
                    <img
                      src="https://inceptiondb.hola.cloud/v2/img/icon-collection.svg"
                      alt="Colecci√≥n"
                      style="height: 16px; filter: invert(82%) saturate(120%);"
                    />
                    <span>{{ collection.name }}</span>
                  </li>
                </ul>
              </li>
            </ul>
          </div>

          <div class="hc-sidebar-section" v-if="project">
            <div class="hc-sidebar-section__title">Lambdas</div>
            <ul class="hc-nav-list">
              <li v-for="lambda in tree.lambdas" :key="lambda.id">
                <div class="hc-nav-item" @click="openLambda(lambda)" :title="lambda.name">
                  <div class="hc-nav-item__label">
                    <img src="img/icon-lambda.png" alt="Lambda" />
                    <span>{{ lambda.method }} {{ lambda.path }}</span>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="hc-sidebar-section" v-if="!projects.length && !loading.fetch">
            <div class="hc-empty-state" style="padding: 1.5rem;">
              <h3>Sin proyectos todav√≠a</h3>
              <p>Crea tu primer proyecto desde el panel derecho para habilitar la navegaci√≥n.</p>
            </div>
          </div>
        </div>
      </aside>

      <main class="hc-workspace">
        <header class="hc-topbar">
          <button
            v-if="ui.isMobile"
            type="button"
            class="hc-sidebar-toggle"
            aria-label="Abrir navegaci√≥n"
            @click="toggleSidebar(true)"
          >
            <span aria-hidden="true">‚ò∞</span>
          </button>
          <div class="hc-topbar__title">
            <h2>Panel de control</h2>
            <span>{{ project ? project.name : 'Selecciona un proyecto para comenzar' }}</span>
          </div>
          <div class="hc-topbar__user">
            <img :src="user.picture" alt="Avatar" class="hc-avatar" />
            <div class="hc-user-meta">
              <strong>{{ user.nick }}</strong>
              <a href="/auth/logout">Cerrar sesi√≥n</a>
            </div>
          </div>
        </header>

        <section class="hc-workspace__content">
          <div v-if="loading.fetch" class="hc-empty-state">
            <div class="hc-spinner">Cargando proyectos‚Ä¶</div>
            <p>Estamos sincronizando tus recursos y configuraciones.</p>
          </div>

          <template v-else>
            <div v-if="!projects.length" class="hc-surface" style="padding: 2.5rem; align-items: center;">
              <form class="hc-form" @submit.prevent="createProject">
                <div>
                  <h2 style="margin: 0 0 0.5rem; font-size: 1.5rem;">Crea tu primer proyecto</h2>
                  <p>Define un nombre para tu proyecto y comenzaremos a preparar tu espacio de trabajo.</p>
                </div>
                <input
                  class="hc-input"
                  type="text"
                  placeholder="Nombre del proyecto"
                  v-model="inputs.name"
                  autofocus
                />
                <div class="hc-form__actions">
                  <button type="submit" class="hc-button" :disabled="!inputs.name.trim()">Crear proyecto</button>
                </div>
              </form>
            </div>

            <div v-else-if="project === null" class="hc-surface" style="padding: 2rem; overflow: auto;">
              <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                <div>
                  <h2 style="margin: 0; font-size: 1.4rem;">Tus proyectos</h2>
                  <p style="margin: 0; color: var(--color-neutral-500);">Selecciona un proyecto para activar el panel de trabajo.</p>
                </div>
                <button
                  v-if="!inputs.showNewProject"
                  class="hc-button"
                  type="button"
                  @click="inputs.showNewProject = true"
                >
                  Nuevo proyecto
                </button>
              </div>

              <div class="hc-projects-grid">
                <div class="hc-project-card" v-for="p in projects" :key="p.id" @click="selectProject(p)">
                  <div class="hc-project-card__title">{{ p.name }}</div>
                  <div class="hc-project-card__meta">
                    <span>{{ p.id }}</span>
                    <span v-if="p.owners && p.owners.length > 1">{{ p.owners.length }} üë§</span>
                  </div>
                  <div class="hc-project-card__actions">
                    <a :href="'https://' + p.host" v-if="p.host" target="_blank" @click.stop>Ver sitio</a>
                    <span v-else style="color: var(--color-neutral-500); font-size: 0.8rem;">Sin host asignado</span>
                  </div>
                </div>
              </div>

              <div v-if="inputs.showNewProject" style="margin-top: 2rem;">
                <form class="hc-form" @submit.prevent="createProject" style="margin: 0;">
                  <h3 style="margin: 0 0 0.5rem;">Crear un nuevo proyecto</h3>
                  <input
                    class="hc-input"
                    type="text"
                    placeholder="Nombre del proyecto"
                    v-model="inputs.name"
                    autofocus
                  />
                  <div class="hc-form__actions">
                    <button type="button" class="hc-button hc-button--ghost" @click="cancelNewProject">Cancelar</button>
                    <button type="submit" class="hc-button" :disabled="!inputs.name.trim()">Crear</button>
                  </div>
                </form>
              </div>
            </div>

            <div v-else class="hc-surface">
              <div class="hc-tabs" role="tablist">
                <button
                  v-for="(t, i) in tabs"
                  :key="t.name + i"
                  class="hc-tab"
                  :class="{'is-active': tab === i}"
                  type="button"
                  @click="tab = i"
                >
                  <img :src="t.icon" :alt="t.name" />
                  <span>{{ t.name }}</span>
                  <span
                    v-if="t.hideClose !== true"
                    class="hc-tab__close"
                    role="button"
                    aria-label="Cerrar pesta√±a"
                    @click.stop="closeTab(i)"
                  >√ó</span>
                </button>
              </div>
              <div class="hc-tab-panels">
                <iframe
                  v-for="(t, i) in tabs"
                  :key="t.url + i"
                  class="hc-panel-frame"
                  :class="{'is-active': tab === i}"
                  :src="t.url || 'about:blank'"
                  :title="t.name"
                ></iframe>
              </div>
              <div class="hc-log-panel" :class="{'is-collapsed': ui.logsCollapsed}">
                <div class="hc-log-panel__header">
                  <span>Logs en vivo</span>
                  <div class="hc-log-panel__actions">
                    <span>{{ project ? project.id : '' }}</span>
                    <button type="button" class="hc-log-toggle" @click="ui.logsCollapsed = !ui.logsCollapsed">
                      {{ ui.logsCollapsed ? 'Mostrar' : 'Ocultar' }}
                    </button>
                  </div>
                </div>
                <iframe class="hc-log-panel__frame" :src="logsUrl" title="Logs"></iframe>
              </div>
            </div>
          </template>
        </section>
      </main>
    </div>
  </div>

  <script src="lib/vue.global.prod.js"></script>
  <script>
    const { createApp } = Vue;

    let hcSelectId = 0;
    const HcSelect = {
      name: 'HcSelect',
      props: {
        id: {
          type: String,
          default: null,
        },
        modelValue: {
          type: [String, Number],
          default: '',
        },
        options: {
          type: Array,
          default: () => [],
        },
        placeholder: {
          type: String,
          default: 'Selecciona una opci√≥n',
        },
        disabled: {
          type: Boolean,
          default: false,
        },
      },
      emits: ['update:modelValue', 'change'],
      data() {
        return {
          isOpen: false,
          highlightedIndex: -1,
          triggerId: this.id || `hc-select-${++hcSelectId}`,
        };
      },
      watch: {
        id(value) {
          if (value) {
            this.triggerId = value;
          }
        },
        modelValue() {
          this.highlightSelected();
        },
        options() {
          this.highlightSelected();
        },
      },
      computed: {
        listId() {
          return `${this.triggerId}-list`;
        },
        selectedOption() {
          return this.options.find((option) => option.value === this.modelValue) || null;
        },
      },
      methods: {
        toggle() {
          if (this.disabled) return;
          if (this.isOpen) {
            this.close(true);
          } else {
            this.open();
          }
        },
        open() {
          if (this.disabled || !this.options.length) return;
          this.isOpen = true;
          this.$nextTick(() => {
            this.highlightSelected();
            const list = this.$refs.list;
            if (list) {
              list.focus({ preventScroll: true });
              const index = this.highlightedIndex >= 0 ? this.highlightedIndex : 0;
              const el = list.children?.[index];
              if (el && el.scrollIntoView) {
                el.scrollIntoView({ block: 'nearest' });
              }
            }
          });
        },
        close(focusTrigger = false) {
          if (!this.isOpen) return;
          this.isOpen = false;
          this.highlightedIndex = -1;
          if (focusTrigger) {
            this.$nextTick(() => {
              this.$refs.trigger?.focus({ preventScroll: true });
            });
          }
        },
        highlightSelected() {
          if (!Array.isArray(this.options) || !this.options.length) {
            this.highlightedIndex = -1;
            return;
          }
          const index = this.options.findIndex((option) => option.value === this.modelValue);
          this.highlightedIndex = index;
        },
        highlight(index) {
          if (index === -1) {
            this.highlightedIndex = -1;
            return;
          }
          if (index < 0 || index >= this.options.length) {
            this.highlightedIndex = -1;
            return;
          }
          if (this.options[index]?.disabled) {
            return;
          }
          this.highlightedIndex = index;
        },
        move(delta) {
          if (!this.options.length) return;
          let index = this.highlightedIndex;
          const length = this.options.length;
          for (let i = 0; i < length; i += 1) {
            index = (index + delta + length) % length;
            const option = this.options[index];
            if (option && !option.disabled) {
              this.highlightedIndex = index;
              const list = this.$refs.list;
              const el = list?.children?.[index];
              if (el && el.scrollIntoView) {
                el.scrollIntoView({ block: 'nearest' });
              }
              break;
            }
          }
        },
        select(option) {
          if (!option || option.disabled) return;
          this.$emit('update:modelValue', option.value);
          this.$emit('change', option.value);
          this.close(true);
        },
        handleTriggerKeydown(event) {
          switch (event.key) {
            case 'ArrowDown':
              event.preventDefault();
              if (!this.isOpen) {
                this.open();
              }
              this.move(1);
              break;
            case 'ArrowUp':
              event.preventDefault();
              if (!this.isOpen) {
                this.open();
              }
              this.move(-1);
              break;
            case 'Enter':
            case ' ':
              event.preventDefault();
              this.toggle();
              break;
            case 'Escape':
              if (this.isOpen) {
                event.preventDefault();
                this.close(true);
              }
              break;
            default:
          }
        },
        handleListKeydown(event) {
          switch (event.key) {
            case 'ArrowDown':
              event.preventDefault();
              this.move(1);
              break;
            case 'ArrowUp':
              event.preventDefault();
              this.move(-1);
              break;
            case 'Home':
              event.preventDefault();
              this.highlight(this.nextEnabledIndex(0, 1));
              break;
            case 'End':
              event.preventDefault();
              this.highlight(this.nextEnabledIndex(this.options.length - 1, -1));
              break;
            case 'Enter':
            case ' ':
              event.preventDefault();
              if (this.highlightedIndex >= 0) {
                this.select(this.options[this.highlightedIndex]);
              }
              break;
            case 'Escape':
              event.preventDefault();
              this.close(true);
              break;
            default:
          }
        },
        nextEnabledIndex(start, step) {
          if (!this.options.length) {
            return -1;
          }
          let index = start;
          for (let i = 0; i < this.options.length; i += 1) {
            const option = this.options[index];
            if (option && !option.disabled) {
              return index;
            }
            index += step;
            if (index < 0) {
              index = this.options.length - 1;
            } else if (index >= this.options.length) {
              index = 0;
            }
          }
          return -1;
        },
        handleOutside(event) {
          if (!this.isOpen) {
            return;
          }
          if (!this.$el.contains(event.target)) {
            this.close();
          }
        },
      },
      mounted() {
        this.highlightSelected();
        document.addEventListener('click', this.handleOutside);
      },
      beforeUnmount() {
        document.removeEventListener('click', this.handleOutside);
      },
      template: `
        <div class="hc-select" :class="{'is-open': isOpen}">
          <button
            ref="trigger"
            :id="triggerId"
            class="hc-select__trigger"
            type="button"
            :aria-expanded="isOpen.toString()"
            :aria-controls="listId"
            :aria-disabled="disabled ? 'true' : 'false'"
            @click="toggle"
            @keydown="handleTriggerKeydown"
          >
            <span class="hc-select__value">
              <span v-if="selectedOption" class="hc-select__label">{{ selectedOption.label }}</span>
              <span v-else class="hc-select__placeholder">{{ placeholder }}</span>
              <span v-if="selectedOption && selectedOption.description" class="hc-select__description">{{ selectedOption.description }}</span>
            </span>
            <span class="hc-select__chevron" aria-hidden="true">‚åÑ</span>
          </button>
          <transition name="hc-select-fade">
            <div v-if="isOpen" class="hc-select__dropdown">
              <ul
                ref="list"
                class="hc-select__list"
                role="listbox"
                tabindex="-1"
                :id="listId"
                :aria-labelledby="triggerId"
                @keydown="handleListKeydown"
              >
                <li
                  v-for="(option, index) in options"
                  :key="option.value ?? index"
                  class="hc-select__option"
                  :class="{ 'is-active': highlightedIndex === index, 'is-selected': option.value === modelValue, 'is-disabled': option.disabled }"
                  role="option"
                  :aria-selected="option.value === modelValue"
                  @mouseenter="highlight(index)"
                  @mouseleave="highlight(-1)"
                  @click="select(option)"
                >
                  <span>
                    <span>{{ option.label }}</span>
                    <span v-if="option.description" class="hc-select__description">{{ option.description }}</span>
                  </span>
                  <span v-if="option.meta" class="hc-select__option-meta">{{ option.meta }}</span>
                </li>
              </ul>
            </div>
          </transition>
        </div>
      `,
    };

    const localdev = document.location.hostname === 'localhost';
    const fakeHeaders = {};
    if (localdev) {
      fakeHeaders['X-Glue-Authentication'] = '{"user":{"id":"user1"}}';
    }

    let base = '';
    let baseprojects = 'https://projects.hola.cloud';
    let baseinception = 'https://inceptiondb.hola.cloud';
    let baselambdas = 'https://lambda.hola.cloud';
    if (localdev) {
      baseprojects = '/fakeapi/projectsapi';
      baseinception = '/fakeapi/inceptionapi';
      baselambdas = '/fakeapi/lambdasapi';
      base = '/fakeapi/authapi';
    }

    const app = createApp({
      data() {
        return {
          projects: [],
          project: null,
          user: 'loading',
          loading: {
            fetch: 0,
          },
          inputs: {
            name: '',
            showNewProject: false,
          },
          tabs: [
            { icon: 'img/icon-database.svg', name: 'InceptionDB', url: 'about:blank', hideClose: true },
            { icon: 'img/icon-lambda.png', name: 'Lambdas', url: 'about:blank', hideClose: true },
            { icon: 'img/icon-config.png', name: 'Config', url: 'about:blank', hideClose: true },
            { icon: 'img/icon-files.png', name: 'Archivos', url: 'about:blank', hideClose: true },
          ],
          tab: 0,
          project_id: '',
          tree: {
            databases: [],
            lambdas: [],
          },
          tricks: {
            showtree: false,
          },
          keySequence: '',
          ui: {
            isMobile: false,
            sidebarOpen: false,
            logsCollapsed: false,
          },
          theme: 'light',
          viewportQuery: null,
          viewportHandler: null,
          themeQuery: null,
          themeHandler: null,
        };
      },
      computed: {
        projectOptions() {
          return this.projects.map((project) => ({
            value: project.id,
            label: project.name,
            description: project.host || project.id,
          }));
        },
        logsUrl() {
          if (!this.project) {
            return 'about:blank';
          }
          return 'https://instantlogs.hola.cloud/?embed&project=' + encodeURIComponent(this.project.id);
        },
      },
      mounted() {
        this.fetchProjects();
        this.fetchCurrentUser();
        document.addEventListener('keyup', this.handleKeySequence, true);
        this.setupViewportWatcher();
        this.setupThemeWatcher();
        this.applyTheme();
      },
      beforeUnmount() {
        document.removeEventListener('keyup', this.handleKeySequence, true);
        this.teardownViewportWatcher();
        this.teardownThemeWatcher();
      },
      methods: {
        setupViewportWatcher() {
          if (typeof window === 'undefined' || !window.matchMedia) {
            this.ui.isMobile = false;
            this.ui.sidebarOpen = true;
            return;
          }
          const query = window.matchMedia('(max-width: 1023px)');
          const handler = (event) => {
            const matches = event.matches !== undefined ? event.matches : event;
            this.ui.isMobile = !!matches;
            this.ui.sidebarOpen = matches ? false : true;
          };
          handler(query);
          if (query.addEventListener) {
            query.addEventListener('change', handler);
          } else if (query.addListener) {
            query.addListener(handler);
          }
          this.viewportQuery = query;
          this.viewportHandler = handler;
        },
        teardownViewportWatcher() {
          const query = this.viewportQuery;
          const handler = this.viewportHandler;
          if (query && handler) {
            if (query.removeEventListener) {
              query.removeEventListener('change', handler);
            } else if (query.removeListener) {
              query.removeListener(handler);
            }
          }
          this.viewportQuery = null;
          this.viewportHandler = null;
        },
        setupThemeWatcher() {
          if (typeof window === 'undefined' || !window.matchMedia) {
            this.theme = 'light';
            this.applyTheme();
            return;
          }
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          const handler = (event) => {
            const matches = event.matches !== undefined ? event.matches : event;
            this.theme = matches ? 'dark' : 'light';
            this.applyTheme();
          };
          handler(query);
          if (query.addEventListener) {
            query.addEventListener('change', handler);
          } else if (query.addListener) {
            query.addListener(handler);
          }
          this.themeQuery = query;
          this.themeHandler = handler;
        },
        teardownThemeWatcher() {
          const query = this.themeQuery;
          const handler = this.themeHandler;
          if (query && handler) {
            if (query.removeEventListener) {
              query.removeEventListener('change', handler);
            } else if (query.removeListener) {
              query.removeListener(handler);
            }
          }
          this.themeQuery = null;
          this.themeHandler = null;
        },
        applyTheme() {
          const target = document.body;
          if (!target) {
            return;
          }
          target.setAttribute('data-theme', this.theme === 'dark' ? 'dark' : 'light');
        },
        toggleSidebar(force) {
          if (typeof force === 'boolean') {
            this.ui.sidebarOpen = force;
          } else {
            this.ui.sidebarOpen = !this.ui.sidebarOpen;
          }
        },
        closeSidebarOnMobile() {
          if (this.ui.isMobile) {
            this.ui.sidebarOpen = false;
          }
        },
        handleKeySequence(event) {
          this.keySequence += event.key;
          if (this.keySequence.length > 20) {
            this.keySequence = this.keySequence.slice(-20);
          }
          if (this.keySequence.endsWith('showtree')) {
            this.tricks.showtree = !this.tricks.showtree;
          }
        },
        fetchCurrentUser() {
          fetch(base + '/auth/me', { credentials: 'include' })
            .then((resp) => resp.json())
            .then((user) => {
              if (user.error) {
                this.user = null;
                return;
              }
              this.user = user;
              if (localdev) {
                fakeHeaders['X-Glue-Authentication'] = JSON.stringify({ user });
              }
              if (this.project_id) {
                this.fetchTree();
              }
              this.fetchProjects();
            })
            .catch(() => {
              this.user = null;
            });
        },
        fetchProjects() {
          this.loading.fetch += 1;
          fetch(baseprojects + '/v0/projects', { headers: {}, credentials: 'include' })
            .then((resp) => resp.json())
            .then((values) => {
              if (!Array.isArray(values)) {
                values = [];
              }
              values.sort((a, b) => (a.name < b.name ? -1 : a.name > b.name ? 1 : 0));
              this.projects = values;
              if (!this.project && this.project_id) {
                const match = this.projects.find((proj) => proj.id === this.project_id);
                if (match) {
                  this.selectProject(match);
                }
              }
            })
            .catch(() => {
              // no-op, errors handled silently to avoid breaking UI
            })
            .finally(() => {
              this.loading.fetch = Math.max(0, this.loading.fetch - 1);
            });
        },
        fetchTree() {
          if (!this.project_id) {
            return;
          }
          fakeHeaders['X-Project'] = this.project_id;
          this.fetchDatabases();
          this.fetchLambdas();
        },
        fetchDatabases() {
          fetch(baseinception + '/v1/databases', {
            headers: fakeHeaders,
            credentials: 'include',
          })
            .then((resp) => resp.json())
            .then((values) => {
              if (!Array.isArray(values)) {
                values = [];
              }
              values.forEach((db) => {
                db.collections = [];
                db.open = false;
              });
              values.sort((a, b) => (a.name < b.name ? -1 : a.name > b.name ? 1 : 0));
              this.tree.databases = values;
            })
            .catch(() => {
              this.tree.databases = [];
            });
        },
        fetchLambdas() {
          fetch(baselambdas + '/api/v0/lambdas', {
            headers: fakeHeaders,
            credentials: 'include',
          })
            .then((resp) => resp.json())
            .then((values) => {
              if (!Array.isArray(values)) {
                values = [];
              }
              values.sort((a, b) => {
                const left = (a.path || '') + ' ' + (a.method || '');
                const right = (b.path || '') + ' ' + (b.method || '');
                return left.localeCompare(right);
              });
              this.tree.lambdas = values;
            })
            .catch(() => {
              this.tree.lambdas = [];
            });
        },
        expandDatabase(db) {
          db.open = !db.open;
          if (!db.open) {
            return;
          }
          fetch(baseinception + '/v1/databases/' + db.id + '/collections', {
            headers: fakeHeaders,
            credentials: 'include',
          })
            .then((resp) => resp.json())
            .then((values) => {
              db.collections = Array.isArray(values) ? values : [];
            })
            .catch(() => {
              db.collections = [];
            });
        },
        selectProject(project) {
          this.project = project;
          this.project_id = project.id;
          if (localdev) {
            fakeHeaders['X-Project'] = project.id;
          }
          this.updateCoreTabs();
          this.fetchTree();
          this.tab = 0;
          this.closeSidebarOnMobile();
        },
        handleProjectChange(value) {
          const selectedValue = typeof value === 'string' ? value : this.project_id;
          if (!selectedValue) {
            this.project = null;
            this.project_id = '';
            this.closeSidebarOnMobile();
            return;
          }
          const project = this.projects.find((p) => p.id === selectedValue);
          if (project) {
            this.selectProject(project);
          }
        },
        updateCoreTabs() {
          if (!this.project) {
            return;
          }
          const projectParam = encodeURIComponent(this.project.id);
          const urls = [
            'https://inceptiondb.hola.cloud/?embed&project=' + projectParam,
            'https://lambda.hola.cloud/?embed&project=' + projectParam,
            'https://config.hola.cloud/?embed&project=' + projectParam,
            'https://files.hola.cloud/?embed&project=' + projectParam,
          ];
          urls.forEach((url, index) => {
            if (this.tabs[index]) {
              this.tabs[index].url = url;
            }
          });
        },
        closeTab(index) {
          this.tabs.splice(index, 1);
          if (this.tab >= this.tabs.length) {
            this.tab = Math.max(0, this.tabs.length - 1);
          }
        },
        openLambda(lambda) {
          if (!this.project_id) {
            return;
          }
          const url =
            'https://lambda.hola.cloud/?embed&project=' +
            encodeURIComponent(this.project_id) +
            '#/lambdas/' +
            lambda.id;
          const existingIndex = this.tabs.findIndex((tab) => tab.url === url);
          if (existingIndex >= 0) {
            this.tab = existingIndex;
            this.closeSidebarOnMobile();
            return;
          }
          this.tabs.push({
            icon: 'img/icon-lambda.png',
            name: (lambda.method || '') + ' ' + (lambda.path || ''),
            url,
          });
          this.tab = this.tabs.length - 1;
          this.closeSidebarOnMobile();
        },
        openCollection(database, collection) {
          if (!this.project_id) {
            return;
          }
          const url =
            'https://inceptiondb.hola.cloud/?embed&project=' +
            encodeURIComponent(this.project_id) +
            '#/databases/' +
            database.id +
            '/collections/' +
            collection.name;
          const existingIndex = this.tabs.findIndex((tab) => tab.url === url);
          if (existingIndex >= 0) {
            this.tab = existingIndex;
            this.closeSidebarOnMobile();
            return;
          }
          this.tabs.push({
            icon: 'img/icon-database.svg',
            name: collection.name,
            url,
          });
          this.tab = this.tabs.length - 1;
          this.closeSidebarOnMobile();
        },
        createProject() {
          if (!this.inputs.name.trim()) {
            return;
          }
          const body = {
            name: this.inputs.name,
          };
          fetch(baseprojects + '/v0/projects', {
            method: 'POST',
            headers: {},
            credentials: 'include',
            body: JSON.stringify(body),
          })
            .then((resp) => resp.json())
            .then((project) => {
              if (!project || !project.id) {
                return;
              }
              this.projects.push(project);
              this.projects.sort((a, b) => (a.name < b.name ? -1 : a.name > b.name ? 1 : 0));
              this.inputs.name = '';
              this.inputs.showNewProject = false;
              this.selectProject(project);
            });
        },
        cancelNewProject() {
          this.inputs.name = '';
          this.inputs.showNewProject = false;
        },
      },
    });

    app.component('HcSelect', HcSelect);
    app.mount('#app');
  </script>
</body>
</html>
